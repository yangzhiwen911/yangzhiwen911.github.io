(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{285:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"dubbo-负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dubbo-负载均衡"}},[t._v("#")]),t._v(" Dubbo 负载均衡")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("在集群负载均衡时，Dubbo 提供了多种均衡策略，缺省为 "),s("code",[t._v("random")]),t._v(" 随机调用。")]),t._v(" "),s("h2",{attrs:{id:"负载均衡策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡策略"}},[t._v("#")]),t._v(" 负载均衡策略")]),t._v(" "),s("h3",{attrs:{id:"随机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#随机"}},[t._v("#")]),t._v(" 随机")]),t._v(" "),s("p",[s("strong",[t._v("Random LoadBalance：")]),t._v(" 按权重设置随机概率，在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。")]),t._v(" "),s("h3",{attrs:{id:"轮循"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#轮循"}},[t._v("#")]),t._v(" 轮循")]),t._v(" "),s("p",[s("strong",[t._v("RoundRobin LoadBalance：")]),t._v(" 按公约后的权重设置轮询比率，存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。")]),t._v(" "),s("h3",{attrs:{id:"最少活跃调用数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最少活跃调用数"}},[t._v("#")]),t._v(" 最少活跃调用数")]),t._v(" "),s("p",[s("strong",[t._v("LeastActive LoadBalance：")]),t._v(" 相同活跃数的随机，活跃数指调用前后计数差，使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。")]),t._v(" "),s("h3",{attrs:{id:"一致性-hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一致性-hash"}},[t._v("#")]),t._v(" 一致性 Hash")]),t._v(" "),s("p",[s("strong",[t._v("ConsistentHash LoadBalance：")]),t._v(" 相同参数的请求总是发到同一提供者。当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。")]),t._v(" "),s("p",[t._v("算法参见："),s("a",{attrs:{href:"http://en.wikipedia.org/wiki/Consistent_hashing",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://en.wikipedia.org/wiki/Consistent_hashing"),s("OutboundLink")],1),t._v(" ，缺省只对第一个参数 Hash，如果要修改，请配置 "),s("code",[t._v('<dubbo:parameter key="hash.arguments" value="0,1" />')]),t._v("，缺省用 160 份虚拟节点，如果要修改，请配置 "),s("code",[t._v('<dubbo:parameter key="hash.nodes" value="320" />')])]),t._v(" "),s("h2",{attrs:{id:"配置负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置负载均衡"}},[t._v("#")]),t._v(" 配置负载均衡")]),t._v(" "),s("ul",[s("li",[t._v("修改 "),s("code",[t._v("dubbo-provider")]),t._v(" 项目的负载均衡策略，默认的负载均衡策略是 "),s("strong",[t._v("随机")]),t._v("，我们修改为 "),s("strong",[t._v("轮循")]),t._v("，可配置的值分别是："),s("code",[t._v("random")]),t._v("，"),s("code",[t._v("roundrobin")]),t._v("，"),s("code",[t._v("leastactive")]),t._v("，"),s("code",[t._v("consistenthash")])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dubbo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("loadbalance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" roundrobin\n")])])]),s("ul",[s("li",[t._v("修改 "),s("code",[t._v("dubbo-provider")]),t._v(" 的协议端口为 20880 和 20881，并启动多个实例，IDEA 中依次点击 "),s("strong",[t._v("Run")]),t._v(" -> "),s("strong",[t._v("Edit Configurations")]),t._v(" 并勾选 "),s("strong",[t._v("Allow parallel run")]),t._v(" 以允许 IDEA 多实例运行项目")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/Lusifer_20190704033645.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("Nacos Server 控制台可以看到 "),s("code",[t._v("dubbo-provider")]),t._v(" 有 2 个实例")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/assets/Lusifer_20190704033745.png",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("修改 "),s("code",[t._v("dubbo-provider")]),t._v(" 项目的 "),s("code",[t._v("EchoServiceImpl")]),t._v(" 中的测试方法")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("funtl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dubbo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("funtl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dubbo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("provider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EchoService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dubbo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("version "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EchoServiceImpl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EchoService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${dubbo.protocol.port}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Echo Hello Dubbo "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" string "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" i am from port: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("重启服务，通过浏览器访问 "),s("a",{attrs:{href:"http://localhost:8080/echo/hi",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:8080/echo/hi"),s("OutboundLink")],1),t._v(" ，反复刷新浏览器，浏览器交替显示")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Echo Hello Dubbo hi i am from port: 20880\nEcho Hello Dubbo hi i am from port: 20881\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);